<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Photo Studio - Diagnostic Page</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #1a202c;
            color: white;
            padding: 20px;
            line-height: 1.6;
        }
        .status {
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
        }
        .success { background-color: #065f46; border: 1px solid #10b981; }
        .error { background-color: #7f1d1d; border: 1px solid #ef4444; }
        .warning { background-color: #78350f; border: 1px solid #f59e0b; }
        .info { background-color: #1e3a8a; border: 1px solid #3b82f6; }
        button {
            background-color: #3b82f6;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background-color: #2563eb; }
        pre {
            background-color: #374151;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <h1>🔧 Photo Studio - Diagnostic Page</h1>
    <p>Use this page to diagnose any issues with the application.</p>
    
    <div class="status info">
        <strong>🌐 Environment:</strong> <span id="environment">Checking...</span>
    </div>
    
    <div class="status info">
        <strong>📍 Current URL:</strong> <span id="currentUrl">Loading...</span>
    </div>
    
    <div class="status" id="localStorage">
        <strong>💾 LocalStorage:</strong> <span id="localStorageStatus">Checking...</span>
    </div>
    
    <div class="status" id="modules">
        <strong>📦 Module Loading:</strong> <span id="moduleStatus">Checking...</span>
    </div>
    
    <div class="status" id="react">
        <strong>⚛️ React:</strong> <span id="reactStatus">Checking...</span>
    </div>
    
    <div class="status" id="fal">
        <strong>🤖 Fal.ai SDK:</strong> <span id="falStatus">Checking...</span>
    </div>
    
    <h3>🛠️ Actions</h3>
    <button onclick="clearStorage()">Clear All Storage</button>
    <button onclick="testFetch()">Test Network</button>
    <button onclick="testReactRender()">Test React Render</button>
    <button onclick="goToApp()">Go to Main App</button>
    
    <h3>📊 Diagnostic Info</h3>
    <pre id="diagnosticInfo">Loading diagnostic information...</pre>
    
    <h3>📝 Console Logs</h3>
    <pre id="consoleLogs"></pre>
    
    <script>
        // Capture console logs
        const originalLog = console.log;
        const originalError = console.error;
        const originalWarn = console.warn;
        let logs = [];
        
        function addLog(level, ...args) {
            logs.push(`[${level}] ${args.join(' ')}`);
            updateConsoleLogs();
        }
        
        console.log = function(...args) {
            addLog('LOG', ...args);
            originalLog.apply(console, args);
        };
        
        console.error = function(...args) {
            addLog('ERROR', ...args);
            originalError.apply(console, args);
        };
        
        console.warn = function(...args) {
            addLog('WARN', ...args);
            originalWarn.apply(console, args);
        };
        
        function updateConsoleLogs() {
            document.getElementById('consoleLogs').textContent = logs.slice(-10).join('\\n');
        }
        
        // Set current URL
        document.getElementById('currentUrl').textContent = window.location.href;
        
        // Check environment
        const isLocalhost = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';
        const isDev = window.location.port && (window.location.port.startsWith('517') || window.location.port === '3000');
        document.getElementById('environment').textContent = isLocalhost ? 'Localhost' : 'Remote' + (isDev ? ' (Development)' : ' (Production)');
        
        // Check localStorage
        function checkLocalStorage() {
            try {
                localStorage.setItem('test', 'test');
                localStorage.removeItem('test');
                document.getElementById('localStorageStatus').textContent = 'Available';
                document.getElementById('localStorage').className = 'status success';
                return true;
            } catch (e) {
                document.getElementById('localStorageStatus').textContent = 'Not Available: ' + e.message;
                document.getElementById('localStorage').className = 'status error';
                return false;
            }
        }
        
        // Check module loading
        function checkModules() {
            try {
                if (typeof import === 'undefined') {
                    throw new Error('ES6 modules not supported');
                }
                document.getElementById('moduleStatus').textContent = 'ES6 Modules Supported';
                document.getElementById('modules').className = 'status success';
            } catch (e) {
                document.getElementById('moduleStatus').textContent = 'Module Error: ' + e.message;
                document.getElementById('modules').className = 'status error';
            }
        }
        
        // Check React
        async function checkReact() {
            try {
                // Try to import React
                const React = await import('react');
                document.getElementById('reactStatus').textContent = 'React loaded successfully';
                document.getElementById('react').className = 'status success';
            } catch (e) {
                document.getElementById('reactStatus').textContent = 'React Error: ' + e.message;
                document.getElementById('react').className = 'status error';
            }
        }
        
        // Check Fal.ai
        async function checkFal() {
            try {
                const fal = await import('@fal-ai/serverless-client');
                document.getElementById('falStatus').textContent = 'Fal.ai SDK loaded successfully';
                document.getElementById('fal').className = 'status success';
            } catch (e) {
                document.getElementById('falStatus').textContent = 'Fal.ai Error: ' + e.message;
                document.getElementById('fal').className = 'status error';
            }
        }
        
        // Update diagnostic info
        function updateDiagnosticInfo() {
            const info = {
                userAgent: navigator.userAgent,
                viewport: `${window.innerWidth}x${window.innerHeight}`,
                localStorage: checkLocalStorage(),
                cookies: navigator.cookieEnabled,
                language: navigator.language,
                platform: navigator.platform,
                timestamp: new Date().toISOString()
            };
            
            document.getElementById('diagnosticInfo').textContent = JSON.stringify(info, null, 2);
        }
        
        // Clear storage
        function clearStorage() {
            try {
                localStorage.clear();
                sessionStorage.clear();
                indexedDB.deleteDatabase('PhotoStudioDB');
                addLog('SUCCESS', 'All storage cleared');
            } catch (e) {
                addLog('ERROR', 'Failed to clear storage:', e.message);
            }
        }
        
        // Test fetch
        function testFetch() {
            fetch('/')
                .then(response => {
                    addLog('SUCCESS', 'Network test passed:', response.status);
                })
                .catch(error => {
                    addLog('ERROR', 'Network test failed:', error.message);
                });
        }
        
        // Test React render
        async function testReactRender() {
            try {
                const React = await import('react');
                const ReactDOM = await import('react-dom/client');
                
                // Create a test div
                const testDiv = document.createElement('div');
                testDiv.id = 'react-test';
                document.body.appendChild(testDiv);
                
                // Try to render a simple component
                const root = ReactDOM.createRoot(testDiv);
                root.render(React.createElement('div', null, 'React test successful!'));
                
                addLog('SUCCESS', 'React render test passed');
                
                // Clean up after 2 seconds
                setTimeout(() => {
                    document.body.removeChild(testDiv);
                }, 2000);
                
            } catch (e) {
                addLog('ERROR', 'React render test failed:', e.message);
            }
        }
        
        // Go to main app
        function goToApp() {
            window.location.href = '/';
        }
        
        // Run initial checks
        document.addEventListener('DOMContentLoaded', () => {
            updateDiagnosticInfo();
            checkLocalStorage();
            checkModules();
            checkReact();
            checkFal();
        });
    </script>
</body>
</html>